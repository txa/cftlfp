
\makeatletter
\@ifundefined{ifsol}{%
  \newif\ifsol
  \soltrue
}{\solfalse}
\makeatother


\usepackage{hyperref}
\hypersetup{
    colorlinks=true, %set true if you want colored links
    linktoc=all,     %set to all if you want both sections and subsections linked
    linkcolor=blue,  %choose some color if you want links to stand out
}

\ifsol
\usepackage[lastexercise,answerdelayed]{exercise}
\else
\usepackage[noanswer,lastexercise]{exercise}
\fi

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{proof}
\usepackage{tikz}
\usepackage{etoolbox}
\usetikzlibrary{cd}
\usepackage{minted}
\usepackage{mathtools}
\usepackage{enumitem}
\usepackage{framed}




\renewcommand{\ExerciseHeader}{{\noindent\textbf{
\ExerciseName\ \ExerciseHeaderNB\ExerciseHeaderTitle
\ExerciseHeaderOrigin\;}}}
\renewcommand{\AnswerHeader}{\noindent{\textbf{Exercise\ \ExerciseHeaderNB:}}\;}
\renewcommand{\ExerciseSkipAfter}{8pt}
\renewcommand{\AnswerSkipAfter}{8pt}

\newtheorem{question}[Exercise]{Question}

\newcommand\abstractname{Abstract}
\makeatletter
\if@titlepage
  \newenvironment{abstract}{%
      \titlepage
      \null\vfil
      \@beginparpenalty\@lowpenalty
      \begin{center}%
        \bfseries \abstractname
        \@endparpenalty\@M
      \end{center}}%
     {\par\vfil\null\endtitlepage}
\else
  \newenvironment{abstract}{%
      \if@twocolumn
        \section*{\abstractname}%
      \else
        \small
        \begin{center}%
          {\bfseries \abstractname\vspace{-.5em}\vspace{\z@}}%
        \end{center}%
        \quotation
      \fi}
      {\if@twocolumn\else\endquotation\fi}
\fi
\makeatother

% endChap.tmp defaults to blank
\newwrite\tempfile
\immediate\openout\tempfile=endChap.tmp
\immediate\write\tempfile{}
\immediate\closeout\tempfile

\pretocmd{\chapter}{%
    % If previous chapter had answers, this will have a solutions section* with \shipoutAnswer.
    % Otherwise, it will be blank
        \input{endChap.tmp} 
    % Blank endChap.tmp, so it will be blank unless an answer sets it
        \immediate\openout\tempfile=endChap.tmp
        \immediate\write\tempfile{}
        \immediate\closeout\tempfile
}{}{}

% Saves the problem statement to theproblem.tmp, and prints it in an Exercise environment
\newenvironment{exercise}
{\VerbatimOut{theproblem.tmp}}
{\endVerbatimOut
  \begin{Exercise}
    \input{theproblem.tmp}
  \end{Exercise}
}

\newenvironment{answer}{%
  % Set endChap.tmp to contain solutions section* and \shipoutAnswer so it will print this answer 
  % (and the others in the chapter) at the end of the chapter
  \immediate\openout\tempfile=endChap.tmp
  \immediate\write\tempfile{\unexpanded{
    \addcontentsline{toc}{section}{Solutions to exercises}\section*{Solutions to exercises}
    \shipoutAnswer
    }}
  \immediate\closeout\tempfile
  
  % Start the Answer by restating the problem (which will be saved in theproblem.tmp)
  \begin{Answer}
    \input{theproblem.tmp}
  
    \noindent\textit{Solution:}
    
}{\end{Answer}}

\newcommand{\checkbox}{$\Box$}
\newcommand{\checked}{\raisebox{-.7pt}{\rlap{$\Box$}\;\!\raisebox{1.4pt}{\checkmark}}}
\newlist{checklist}{itemize}{3}
\setlist{noitemsep}
\setlist[checklist]{label={\checkbox}}


\newenvironment{Checklist}[2][]{
  \begin{figure}[t] \label{checklist:#2}
    \begin{framed}
      \begin{center}
      \textbf{#2~checklist}\ifx{#1}{}{}\else{:~#1}\fi
      \vspace{0.25cm}
      \hrule
      \vspace{0.25cm}
    
    \begin{checklist}
}
{
    \end{checklist}
\end{center}
\end{framed}
\end{figure}
}
\newcommand{\NextColumn}{\end{checklist}\end{minipage}\begin{minipage}[t]{0.49\textwidth}\begin{checklist}}
\newenvironment{DoubleChecklist}[2][]{
  \begin{figure}[t] \label{checklist:#2}
    \begin{framed} \centering
    \textbf{#2~checklist}\ifx{#1}{}{}\else{:~#1}\fi
    \vspace{0.25cm}
    \hrule
    \vspace{0.25cm}
    \begin{minipage}[t]{0.49\textwidth}
    \begin{checklist}
}
{
    \end{checklist}
  \end{minipage}
\end{framed}
\end{figure}
}

\newenvironment{NamedDoubleChecklist}[4][]{
  \begin{figure}[t] \label{checklist:#2}
    \renewcommand{\NextColumn}{\end{checklist}\end{minipage}\begin{minipage}[t]{0.49\textwidth}
      \begin{center}\itshape #4\end{center}
      \begin{checklist}}
    \begin{framed} \centering
    \textbf{#2~checklist}\ifx{#1}{}{}\else{:~#1}\fi
    \vspace{0.25cm}
    \hrule
    \vspace{0.25cm}
    \begin{minipage}[t]{0.49\textwidth}
      \begin{center}\itshape #3\end{center}
    \begin{checklist}
}
{
    \end{checklist}
  \end{minipage}
\end{framed}
\end{figure}
}

\newcommand{\checklistref}[1]{\hyperref[checklist:#1]{#1~checklist}}